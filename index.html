<!DOCTYPE html>
<html lang="en">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
Â  Â  <title>GeoTrack WebView</title>
Â  Â Â 
Â  Â  Â  Â  <script src="https://cdn.tailwindcss.com"></script>
Â  Â Â 
Â  Â  Â  Â  <link href="https://unpkg.com/maplibre-gl@5.14.0/dist/maplibre-gl.css" rel="stylesheet" />
Â  Â Â 
Â  Â  Â  Â  <script src="https://unpkg.com/@phosphor-icons/web"></script>

Â  Â  <style>
Â  Â  Â  Â  /* Map Container Height adjustment */
Â  Â  Â  Â  #map {
Â  Â  Â  Â  Â  Â  height: 100%;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  z-index: 10;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* MapLibre specific marker styling */
Â  Â  Â  Â  .user-marker {
Â  Â  Â  Â  Â  Â  background-color: #2563eb;
Â  Â  Â  Â  Â  Â  width: 24px;
Â  Â  Â  Â  Â  Â  height: 24px;
Â  Â  Â  Â  Â  Â  border-radius: 50%;
Â  Â  Â  Â  Â  Â  border: 3px solid white;
Â  Â  Â  Â  Â  Â  box-shadow: 0 4px 6px rgba(0,0,0,0.3);
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Hide MapLibre default controls for a cleaner app look */
Â  Â  Â  Â  .maplibregl-ctrl {
Â  Â  Â  Â  Â  Â  display: none !important;
Â  Â  Â  Â  }
Â  Â  </style>
</head>
<body class="bg-gray-50 text-gray-800 h-screen w-screen overflow-hidden flex flex-col font-sans select-none">

Â  Â  Â  Â  <main class="flex-grow relative overflow-hidden bg-gray-100">
Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <div id="view-map" class="absolute inset-0 flex flex-col">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="map" class="bg-gray-200"></div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="absolute bottom-24 right-6 flex flex-col space-y-3 z-[400] drop-shadow-lg">
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="zoomIn()" class="bg-white text-gray-700 p-2.5 rounded-full shadow-lg hover:bg-gray-100 transition-colors active:scale-95 ring-1 ring-gray-300 w-12 h-12 flex items-center justify-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="ph ph-plus text-2xl"></i>
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="zoomOut()" class="bg-white text-gray-700 p-2.5 rounded-full shadow-lg hover:bg-gray-100 transition-colors active:scale-95 ring-1 ring-gray-300 w-12 h-12 flex items-center justify-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="ph ph-minus text-2xl"></i>
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="absolute bottom-4 left-0 right-0 flex justify-center z-[400] px-6">
Â  Â  Â  Â  Â  Â  Â  Â  <button id="btn-toggle-track" onclick="toggleTracking()" class="shadow-2xl bg-blue-600 hover:bg-blue-700 text-white w-full max-w-md h-16 rounded-2xl flex items-center justify-center gap-3 font-bold text-xl active:scale-95 transition-all duration-200 ring-4 ring-white/30 backdrop-blur-sm">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i id="btn-icon" class="ph-fill ph-play text-2xl"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span id="btn-text">Start Tracking</span>
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="geofence-status" class="absolute top-4 left-4 bg-white px-4 py-2 rounded-lg shadow-lg z-[400] font-semibold">
Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-gray-500">Checking...</span>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  </main>

Â  Â  Â  Â  <script>
Â  Â  Â  Â  // Explicitly set the worker URL to prevent SecurityErrors when running in restricted environments.
Â  Â  Â  Â  window.maplibregl = window.maplibregl || {};
Â  Â  Â  Â  window.maplibregl.workerUrl = 'https://unpkg.com/maplibre-gl@5.14.0/dist/maplibre-gl-worker.js';
Â  Â  </script>

Â  Â  Â  Â  <script src="https://unpkg.com/maplibre-gl@5.14.0/dist/maplibre-gl.js"></script>

Â  Â  <script>
Â  Â  Â  Â  // --- 1. Map Initialization ---

Â  Â  Â  Â  // Default Location (New York Central Park)
Â  Â  Â  Â  const DEFAULT_LNG = -73.968285;
Â  Â  Â  Â  const DEFAULT_LAT = 40.785091;
Â  Â  Â  Â  const startLngLat = [DEFAULT_LNG, DEFAULT_LAT];
Â  Â  Â  Â  const geofenceCenter = [72.8777, 19.0760]; // Thane, Maharashtra
Â  Â  Â  Â  const geofenceRadius = 2000; // meters
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Geofence state tracking
Â  Â  Â  Â  let isInside = false;
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Initialize MapLibre Map
Â  Â  Â  Â  const map = new maplibregl.Map({
Â  Â  Â  Â  Â  Â  container: 'map',
Â  Â  Â  Â  Â  Â  style: {
Â  Â  Â  Â  Â  Â  Â  Â  version: 8,
Â  Â  Â  Â  Â  Â  Â  Â  sources: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'carto-tiles': {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type: 'raster',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tiles: [
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'https://a.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}.png',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'https://b.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}.png',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'https://c.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}.png'
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ],
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tileSize: 256,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  attribution: 'Â© CARTO'
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  layers: [
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  id: 'simple-tiles',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type: 'raster',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  source: 'carto-tiles',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  minzoom: 0,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  maxzoom: 22
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  ]
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  center: startLngLat,
Â  Â  Â  Â  Â  Â  zoom: 14,
Â  Â  Â  Â  Â  Â  attributionControl: false
Â  Â  Â  Â  });

Â  Â  Â  Â  // Custom User Marker Setup
Â  Â  Â  Â  const el = document.createElement('div');
Â  Â  Â  Â  el.className = 'user-marker';

Â  Â  Â  Â  const userMarker = new maplibregl.Marker({ element: el })
Â  Â  Â  Â  Â  Â  .setLngLat([DEFAULT_LNG, DEFAULT_LAT])
Â  Â  Â  Â  Â  Â  .addTo(map);

Â  Â  Â  Â  map.on('load', () => {
Â  Â  Â  Â  Â  Â  // Add geofence circle source
Â  Â  Â  Â  Â  Â  map.addSource('geofence', {
Â  Â  Â  Â  Â  Â  Â  Â  type: 'geojson',
Â  Â  Â  Â  Â  Â  Â  Â  data: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type: 'Feature',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  geometry: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type: 'Point',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  coordinates: geofenceCenter
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  // Add geofence fill layer
Â  Â  Â  Â  Â  Â  map.addLayer({
Â  Â  Â  Â  Â  Â  Â  Â  id: 'geofence-fill',
Â  Â  Â  Â  Â  Â  Â  Â  type: 'circle',
Â  Â  Â  Â  Â  Â  Â  Â  source: 'geofence',
Â  Â  Â  Â  Â  Â  Â  Â  paint: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'circle-radius': {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  stops: [
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  [0, 0],
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  [20, metersToPixelsAtMaxZoom(geofenceRadius, geofenceCenter[1])]
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ],
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  base: 2
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'circle-color': '#3b82f6',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'circle-opacity': 0.2
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  // Add geofence border layer
Â  Â  Â  Â  Â  Â  map.addLayer({
Â  Â  Â  Â  Â  Â  Â  Â  id: 'geofence-border',
Â  Â  Â  Â  Â  Â  Â  Â  type: 'circle',
Â  Â  Â  Â  Â  Â  Â  Â  source: 'geofence',
Â  Â  Â  Â  Â  Â  Â  Â  paint: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'circle-radius': {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  stops: [
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  [0, 0],
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  [20, metersToPixelsAtMaxZoom(geofenceRadius, geofenceCenter[1])]
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ],
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  base: 2
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'circle-color': '#3b82f6',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'circle-opacity': 0,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'circle-stroke-width': 2,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'circle-stroke-color': '#3b82f6',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'circle-stroke-opacity': 0.8
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  // Check initial position
Â  Â  Â  Â  Â  Â  checkGeofence(DEFAULT_LAT, DEFAULT_LNG);
Â  Â  Â  Â  });

Â  Â  Â  Â  // Geofence checking function (FIXED CODE STARTS HERE)
Â  Â  Â  Â  function checkGeofence(lat, lng) {
Â  Â  Â  Â  Â  Â  const distance = getDistance(
Â  Â  Â  Â  Â  Â  Â  Â  geofenceCenter[1], geofenceCenter[0],
Â  Â  Â  Â  Â  Â  Â  Â  lat, lng
Â  Â  Â  Â  Â  Â  );

Â  Â  Â  Â  Â  Â  const wasInside = isInside;
Â  Â  Â  Â  Â  Â  isInside = distance <= geofenceRadius;

Â  Â  Â  Â  Â  Â  //const statusEl = document.getElementById('geofence-status');

Â  Â  Â  Â  Â  Â  if(window.TouristAppInterface){

Â  Â  Â  Â  Â  Â  Â  Â  if (isInside) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  //statusEl.innerHTML = '<span class="text-green-600">âœ“ Inside Geofence</span>';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!wasInside) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  window.TouristAppInterface.setGeofenceStatus("Geofence Entered");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  //console.log('ðŸŸ¢ GEOFENCE ENTERED');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  //sendToAndroid('geofenceEntered', { lat, lng, distance });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  //statusEl.innerHTML = '<span class="text-red-600">âœ— Outside Geofence</span>';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (wasInside) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  window.TouristAppInterface.setGeofenceStatus("Geofence Exited");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  //console.log('ðŸ”´ GEOFENCE EXITED');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  //sendToAndroid('geofenceExited', { lat, lng, distance });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  let currentValue = window.TouristAppInterface.getGeofenceStatus();
Â  Â  Â  Â  Â  Â  Â  Â  console.log(currentValue);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  else{
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Tourist App Not Found");
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  // Haversine distance calculation
Â  Â  Â  Â  function getDistance(lat1, lon1, lat2, lon2) {
Â  Â  Â  Â  Â  Â  const R = 6371e3; // Earth radius in meters
Â  Â  Â  Â  Â  Â  const Ï†1 = lat1 * Math.PI / 180;
Â  Â  Â  Â  Â  Â  const Ï†2 = lat2 * Math.PI / 180;
Â  Â  Â  Â  Â  Â  const Î”Ï† = (lat2 - lat1) * Math.PI / 180;
Â  Â  Â  Â  Â  Â  const Î”Î» = (lon2 - lon1) * Math.PI / 180;

Â  Â  Â  Â  Â  Â  const a = Math.sin(Î”Ï† / 2) * Math.sin(Î”Ï† / 2) +
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Math.cos(Ï†1) * Math.cos(Ï†2) *
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Math.sin(Î”Î» / 2) * Math.sin(Î”Î» / 2);
Â  Â  Â  Â  Â  Â  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));

Â  Â  Â  Â  Â  Â  return R * c;
Â  Â  Â  Â  }

Â  Â  Â  Â  // Convert meters to pixels at max zoom
Â  Â  Â  Â  function metersToPixelsAtMaxZoom(meters, latitude) {
Â  Â  Â  Â  Â  Â  return meters / 0.075 / Math.cos(latitude * Math.PI / 180);
Â  Â  Â  Â  }

Â  Â  Â  Â  // Zoom Controls
Â  Â  Â  Â  function zoomIn() {
Â  Â  Â  Â  Â  Â  map.zoomIn({ duration: 300 });Â 
Â  Â  Â  Â  }

Â  Â  Â  Â  function zoomOut() {
Â  Â  Â  Â  Â  Â  map.zoomOut({ duration: 300 });Â 
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- 2. Interaction Logic ---

Â  Â  Â  Â  // Bridge to Android (Native)
Â  Â  Â  Â  function sendToAndroid(action, data) {
Â  Â  Â  Â  Â  Â  console.log(`Sending to Android -> Action: ${action}, Data:`, data);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (typeof Android !== 'undefined' && Android.handleAction) {
Â  Â  Â  Â  Â  Â  Â  Â  Android.handleAction(action, JSON.stringify(data || {}));
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- 3. Tracking Logic ---
Â  Â  Â  Â  let isTracking = false;
Â  Â  Â  Â  let watchId = null;

Â  Â  Â  Â  function toggleTracking() {
Â  Â  Â  Â  Â  Â  const btn = document.getElementById('btn-toggle-track');
Â  Â  Â  Â  Â  Â  const btnText = document.getElementById('btn-text');
Â  Â  Â  Â  Â  Â  const btnIcon = document.getElementById('btn-icon');

Â  Â  Â  Â  Â  Â  if (!isTracking) {
Â  Â  Â  Â  Â  Â  Â  Â  // START
Â  Â  Â  Â  Â  Â  Â  Â  isTracking = true;
Â  Â  Â  Â  Â  Â  Â  Â  btn.classList.remove('bg-blue-600', 'hover:bg-blue-700');
Â  Â  Â  Â  Â  Â  Â  Â  btn.classList.add('bg-red-500', 'hover:bg-red-600');
Â  Â  Â  Â  Â  Â  Â  Â  btnText.innerText = "Stop Tracking";
Â  Â  Â  Â  Â  Â  Â  Â  btnIcon.classList.remove('ph-play');
Â  Â  Â  Â  Â  Â  Â  Â  btnIcon.classList.add('ph-stop');
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  sendToAndroid('startTracking');
Â  Â  Â  Â  Â  Â  Â  Â  startWatchingPosition();
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  // STOP
Â  Â  Â  Â  Â  Â  Â  Â  isTracking = false;
Â  Â  Â  Â  Â  Â  Â  Â  btn.classList.add('bg-blue-600', 'hover:bg-blue-700');
Â  Â  Â  Â  Â  Â  Â  Â  btn.classList.remove('bg-red-500', 'hover:bg-red-600');
Â  Â  Â  Â  Â  Â  Â  Â  btnText.innerText = "Start Tracking";
Â  Â  Â  Â  Â  Â  Â  Â  btnIcon.classList.remove('ph-stop');
Â  Â  Â  Â  Â  Â  Â  Â  btnIcon.classList.add('ph-play');

Â  Â  Â  Â  Â  Â  Â  Â  sendToAndroid('stopTracking');
Â  Â  Â  Â  Â  Â  Â  Â  stopWatchingPosition();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  function startWatchingPosition() {
Â  Â  Â  Â  Â  Â  if (watchId !== null) return;

Â  Â  Â  Â  Â  Â  if (!navigator.geolocation) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Geolocation is not supported");
Â  Â  Â  Â  Â  Â  Â  Â  alert("Geolocation is not supported by your browser");
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  watchId = navigator.geolocation.watchPosition(
Â  Â  Â  Â  Â  Â  Â  Â  (position) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const lat = position.coords.latitude;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const lng = position.coords.longitude;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const accuracy = position.coords.accuracy;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const timestamp = new Date(position.timestamp);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log('Position Update:', {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  lat,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  lng,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  accuracy: `${accuracy.toFixed(2)}m`,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  timestamp: timestamp.toLocaleTimeString()
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Update marker position
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  userMarker.setLngLat([lng, lat]);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  map.panTo([lng, lat], { duration: 1000 });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Check geofence
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  checkGeofence(lat, lng);
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  (error) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error("Geolocation Error:", error.message);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  switch(error.code) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  case error.PERMISSION_DENIED:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alert('Location permission denied');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  case error.POSITION_UNAVAILABLE:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alert('Location information unavailable');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  case error.TIMEOUT:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alert('Location request timed out');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Stop tracking on error
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  toggleTracking();
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  enableHighAccuracy: true,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  maximumAge: 0,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  timeout: 10000
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  );

Â  Â  Â  Â  Â  Â  console.log("Started watching position...");
Â  Â  Â  Â  }

Â  Â  Â  Â  function stopWatchingPosition() {
Â  Â  Â  Â  Â  Â  if (watchId !== null) {
Â  Â  Â  Â  Â  Â  Â  Â  navigator.geolocation.clearWatch(watchId);
Â  Â  Â  Â  Â  Â  Â  Â  watchId = null;
Â  Â  Â  Â  Â  Â  Â  Â  console.log("Stopped watching position");
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  </script>
</body>
</html>
